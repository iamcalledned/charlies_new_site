<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pitfall Clone</title>
  <style>
    /* Center the canvas, black border like Atari TV */
    body {
      margin: 0;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      overflow: hidden;
    }
    canvas {
      background: #68c8f9; /* sky blue */
      border: 6px solid #000;
      image-rendering: pixelated; /* crisp retro look */
    }
    #ui {
      position: absolute;
      top: 10px;
      left: 10px;
      color: #fff;
      font: bold 20px monospace;
      text-shadow: 1px 1px 0 #000;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="800" height="400"></canvas>
  <div id="ui">Score: 0</div>

  <script>
    // ==== CONFIG & STATE ====
    const canvas = document.getElementById('gameCanvas');
    const ctx    = canvas.getContext('2d');
    const ui     = document.getElementById('ui');
    const W      = canvas.width;
    const H      = canvas.height;
    const groundY     = H - 50;
    const scrollSpeed = 3;

    let player = { x:100, y:0, w:40, h:50, vy:0, onGround:false };
    let holes      = [];
    let treasures  = [];
    let keys       = {};
    let score      = 0;
    let gameOver   = false;

    // ==== INITIALIZATION ====
    function init() {
      player.y        = groundY - player.h;
      player.vy       = 0;
      holes           = [];
      treasures       = [];
      score           = 0;
      gameOver        = false;
      ui.textContent  = 'Score: 0';

      // Pre-spawn a few holes ahead of the screen
      let x = W;
      for (let i = 0; i < 3; i++) {
        x += rnd(300, 500);
        let w = rnd(80, 150);
        holes.push({ x, width: w });
        if (Math.random() < 0.3) {
          // 30% chance of a treasure above each new hole
          treasures.push({ x: x + w / 2, y: groundY - 60, size: 20 });
        }
      }
    }

    function rnd(min, max) {
      return min + Math.random() * (max - min);
    }

    // ==== INPUT HANDLING ====
    document.addEventListener('keydown', e => {
      keys[e.code] = true;
      if (gameOver && e.code === 'KeyR') init();
    });
    document.addEventListener('keyup', e => {
      keys[e.code] = false;
    });

    // ==== GAME LOOP ====
    function update() {
      if (gameOver) return;

      // Jump
      if ((keys['Space'] || keys['ArrowUp']) && player.onGround) {
        player.vy = -12;
        player.onGround = false;
      }

      // Gravity
      player.vy += 0.5;
      player.y  += player.vy;
      if (player.y >= groundY - player.h) {
        player.y = groundY - player.h;
        player.vy = 0;
        player.onGround = true;
      }

      // Scroll level
      holes.forEach(h => h.x -= scrollSpeed);
      treasures.forEach(t => t.x -= scrollSpeed);

      // Recycle holes
      if (holes.length && holes[0].x + holes[0].width < 0) {
        holes.shift();
        let last = holes[holes.length - 1];
        let x    = last.x + rnd(300, 500);
        let w    = rnd(80, 150);
        holes.push({ x, width: w });
        if (Math.random() < 0.3) {
          treasures.push({ x: x + w / 2, y: groundY - 60, size: 20 });
        }
      }

      // Clean up off-screen treasures
      treasures = treasures.filter(t => t.x + t.size > 0);

      // Treasure collision
      for (let i = treasures.length - 1; i >= 0; i--) {
        let t = treasures[i];
        if (
          player.x < t.x + t.size &&
          player.x + player.w > t.x &&
          player.y < t.y + t.size &&
          player.y + player.h > t.y
        ) {
          treasures.splice(i, 1);
          score++;
          ui.textContent = 'Score: ' + score;
        }
      }

      // Falling in a hole -> game over
      if (player.onGround) {
        let px = player.x + player.w / 2;
        holes.forEach(h => {
          if (px > h.x && px < h.x + h.width) {
            gameOver = true;
          }
        });
      }
    }

    function draw() {
      // Sky
      ctx.fillStyle = '#68c8f9';
      ctx.fillRect(0, 0, W, H);

      // Ground
      ctx.fillStyle = '#654321';
      ctx.fillRect(0, groundY, W, 50);

      // Holes (erase ground)
      ctx.fillStyle = '#68c8f9';
      holes.forEach(h => ctx.fillRect(h.x, groundY, h.width, 50));

      // Treasures
      ctx.fillStyle = 'gold';
      treasures.forEach(t => ctx.fillRect(t.x, t.y, t.size, t.size));

      // Player
      ctx.fillStyle = '#ff0000';
      ctx.fillRect(player.x, player.y, player.w, player.h);

      // Game Over overlay
      if (gameOver) {
        ctx.fillStyle = 'rgba(0,0,0,0.7)';
        ctx.fillRect(0, 0, W, H);
        ctx.fillStyle = '#fff';
        ctx.font = '48px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('Game Over', W / 2, H / 2 - 20);
        ctx.font = '24px sans-serif';
        ctx.fillText("Press 'R' to restart", W / 2, H / 2 + 20);
      }
    }

    function loop() {
      update();
      draw();
      requestAnimationFrame(loop);
    }

    // ==== START ====
    init();
    requestAnimationFrame(loop);
  </script>
</body>
</html>
